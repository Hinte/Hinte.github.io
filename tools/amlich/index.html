<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chuyển Đổi Âm Lịch - Hinte Tools</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .back-link {
            color: white;
            text-decoration: none;
            opacity: 0.8;
            font-size: 0.9rem;
        }

        .back-link:hover {
            opacity: 1;
        }

        .converter-section {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .converter-section h2 {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.3rem;
            color: #ffeb3b;
        }

        .date-inputs {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .input-group label {
            margin-bottom: 5px;
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .input-group select,
        .input-group input {
            padding: 10px 15px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            background: white;
            color: #333;
            min-width: 100px;
            text-align: center;
        }

        .input-group select:focus,
        .input-group input:focus {
            outline: 2px solid #ffeb3b;
        }

        .convert-btn {
            display: block;
            margin: 0 auto;
            padding: 12px 40px;
            background: #ffeb3b;
            color: #333;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .convert-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
        }

        .result-box {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            color: #333;
            text-align: center;
        }

        .result-box h3 {
            color: #c0392b;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .result-date {
            font-size: 2rem;
            font-weight: bold;
            color: #e74c3c;
            margin-bottom: 10px;
        }

        .result-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .detail-item {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
        }

        .detail-item .label {
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 5px;
        }

        .detail-item .value {
            font-size: 1.1rem;
            font-weight: bold;
            color: #333;
        }

        .today-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 25px;
            color: #333;
            text-align: center;
        }

        .today-section h2 {
            color: #c0392b;
            margin-bottom: 15px;
        }

        .today-solar {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .today-lunar {
            font-size: 2rem;
            font-weight: bold;
            color: #e74c3c;
            margin-bottom: 10px;
        }

        .today-info {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
        }

        .info-badge {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: bold;
        }

        .calendar-grid {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 20px;
            color: #333;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .calendar-header h3 {
            color: #c0392b;
        }

        .calendar-nav {
            display: flex;
            gap: 10px;
        }

        .calendar-nav button {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
        }

        .calendar-nav button:hover {
            background: #c0392b;
        }

        .calendar-table {
            width: 100%;
            border-collapse: collapse;
        }

        .calendar-table th {
            background: #e74c3c;
            color: white;
            padding: 10px;
            text-align: center;
        }

        .calendar-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
            vertical-align: top;
            height: 70px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .calendar-table td:hover {
            background: #fff3f3;
        }

        .calendar-table td.today {
            background: #ffeb3b;
        }

        .calendar-table td.other-month {
            color: #ccc;
        }

        .calendar-table td .solar-day {
            font-size: 1.2rem;
            font-weight: bold;
        }

        .calendar-table td .lunar-day {
            font-size: 0.75rem;
            color: #e74c3c;
            margin-top: 3px;
        }

        .calendar-table td.sunday .solar-day {
            color: #e74c3c;
        }

        .calendar-table td.saturday .solar-day {
            color: #3498db;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.5rem;
            }

            .date-inputs {
                flex-direction: column;
                align-items: center;
            }

            .calendar-table td {
                height: 55px;
                padding: 4px;
            }

            .calendar-table td .solar-day {
                font-size: 1rem;
            }

            .calendar-table td .lunar-day {
                font-size: 0.65rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <a href="/" class="back-link" data-lang="back">&larr; Quay lại trang chủ</a>
                <button onclick="toggleLang()" style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 8px 16px; border-radius: 20px; cursor: pointer; font-size: 0.85rem;">
                    <span id="lang-text">EN</span>
                </button>
            </div>
            <h1 data-lang="title">Chuyển Đổi Âm Lịch</h1>
            <p data-lang="subtitle">Chuyển đổi giữa Dương lịch và Âm lịch Việt Nam</p>
        </header>

        <!-- Calendar -->
        <div class="calendar-grid" style="margin-bottom: 25px;">
            <div class="calendar-header">
                <button class="calendar-nav" onclick="changeMonth(-1)">&#9664;</button>
                <h3 id="calendar-title"></h3>
                <button class="calendar-nav" onclick="changeMonth(1)">&#9654;</button>
            </div>
            <table class="calendar-table">
                <thead>
                    <tr>
                        <th data-lang="sun">CN</th>
                        <th data-lang="mon">T2</th>
                        <th data-lang="tue">T3</th>
                        <th data-lang="wed">T4</th>
                        <th data-lang="thu">T5</th>
                        <th data-lang="fri">T6</th>
                        <th data-lang="sat">T7</th>
                    </tr>
                </thead>
                <tbody id="calendar-body">
                </tbody>
            </table>
        </div>

        <!-- Today's Date -->
        <div class="today-section">
            <h2 data-lang="today-title">Hôm Nay</h2>
            <div class="today-solar" id="today-solar"></div>
            <div class="today-lunar" id="today-lunar"></div>
            <div class="today-info">
                <span class="info-badge" id="today-can-chi"></span>
                <span class="info-badge" id="today-tiet-khi"></span>
            </div>
        </div>

        <!-- Solar to Lunar Converter -->
        <div class="converter-section">
            <h2 data-lang="solar-to-lunar">Dương Lịch → Âm Lịch</h2>
            <div class="date-inputs">
                <div class="input-group">
                    <label data-lang="day">Ngày</label>
                    <select id="solar-day"></select>
                </div>
                <div class="input-group">
                    <label data-lang="month">Tháng</label>
                    <select id="solar-month"></select>
                </div>
                <div class="input-group">
                    <label data-lang="year">Năm</label>
                    <input type="number" id="solar-year" min="1900" max="2100" value="2025">
                </div>
            </div>
            <button class="convert-btn" onclick="convertSolarToLunar()" data-lang="convert">Chuyển Đổi</button>
            <div class="result-box" id="solar-result" style="display: none;">
                <h3 data-lang="lunar-result">Kết Quả Âm Lịch</h3>
                <div class="result-date" id="lunar-date-result"></div>
                <div class="result-details" id="lunar-details"></div>
            </div>
        </div>

        <!-- Lunar to Solar Converter -->
        <div class="converter-section">
            <h2 data-lang="lunar-to-solar">Âm Lịch → Dương Lịch</h2>
            <div class="date-inputs">
                <div class="input-group">
                    <label data-lang="day">Ngày</label>
                    <select id="lunar-day"></select>
                </div>
                <div class="input-group">
                    <label data-lang="month">Tháng</label>
                    <select id="lunar-month"></select>
                </div>
                <div class="input-group">
                    <label data-lang="leap-month">Tháng Nhuận</label>
                    <select id="lunar-leap">
                        <option value="0" data-lang="no">Không</option>
                        <option value="1" data-lang="yes">Có</option>
                    </select>
                </div>
                <div class="input-group">
                    <label data-lang="year">Năm</label>
                    <input type="number" id="lunar-year" min="1900" max="2100" value="2025">
                </div>
            </div>
            <button class="convert-btn" onclick="convertLunarToSolar()" data-lang="convert">Chuyển Đổi</button>
            <div class="result-box" id="lunar-result" style="display: none;">
                <h3 data-lang="solar-result">Kết Quả Dương Lịch</h3>
                <div class="result-date" id="solar-date-result"></div>
            </div>
        </div>
    </div>

    <script>
        // Vietnamese Lunar Calendar Algorithm
        // Based on Ho Ngoc Duc's algorithm

        const PI = Math.PI;

        // Thiên Can (Heavenly Stems)
        const CAN = ['Giáp', 'Ất', 'Bính', 'Đinh', 'Mậu', 'Kỷ', 'Canh', 'Tân', 'Nhâm', 'Quý'];

        // Địa Chi (Earthly Branches)
        const CHI = ['Tý', 'Sửu', 'Dần', 'Mão', 'Thìn', 'Tỵ', 'Ngọ', 'Mùi', 'Thân', 'Dậu', 'Tuất', 'Hợi'];

        // Tiết Khí (Solar Terms)
        const TIET_KHI = [
            'Xuân phân', 'Thanh minh', 'Cốc vũ', 'Lập hạ', 'Tiểu mãn', 'Mang chủng',
            'Hạ chí', 'Tiểu thử', 'Đại thử', 'Lập thu', 'Xử thử', 'Bạch lộ',
            'Thu phân', 'Hàn lộ', 'Sương giáng', 'Lập đông', 'Tiểu tuyết', 'Đại tuyết',
            'Đông chí', 'Tiểu hàn', 'Đại hàn', 'Lập xuân', 'Vũ thủy', 'Kinh trập'
        ];

        // Day names
        const DAY_NAMES = ['Chủ Nhật', 'Thứ Hai', 'Thứ Ba', 'Thứ Tư', 'Thứ Năm', 'Thứ Sáu', 'Thứ Bảy'];
        const MONTH_NAMES = ['Tháng 1', 'Tháng 2', 'Tháng 3', 'Tháng 4', 'Tháng 5', 'Tháng 6',
                            'Tháng 7', 'Tháng 8', 'Tháng 9', 'Tháng 10', 'Tháng 11', 'Tháng 12'];

        function jdFromDate(dd, mm, yy) {
            let a = Math.floor((14 - mm) / 12);
            let y = yy + 4800 - a;
            let m = mm + 12 * a - 3;
            let jd = dd + Math.floor((153 * m + 2) / 5) + 365 * y + Math.floor(y / 4) - Math.floor(y / 100) + Math.floor(y / 400) - 32045;
            if (jd < 2299161) {
                jd = dd + Math.floor((153 * m + 2) / 5) + 365 * y + Math.floor(y / 4) - 32083;
            }
            return jd;
        }

        function jdToDate(jd) {
            let a, b, c, d, e, m, day, month, year;
            if (jd > 2299160) {
                a = jd + 32044;
                b = Math.floor((4 * a + 3) / 146097);
                c = a - Math.floor((b * 146097) / 4);
            } else {
                b = 0;
                c = jd + 32082;
            }
            d = Math.floor((4 * c + 3) / 1461);
            e = c - Math.floor((1461 * d) / 4);
            m = Math.floor((5 * e + 2) / 153);
            day = e - Math.floor((153 * m + 2) / 5) + 1;
            month = m + 3 - 12 * Math.floor(m / 10);
            year = b * 100 + d - 4800 + Math.floor(m / 10);
            return [day, month, year];
        }

        function getNewMoonDay(k, timeZone) {
            let T = k / 1236.85;
            let T2 = T * T;
            let T3 = T2 * T;
            let dr = PI / 180;
            let Jd1 = 2415020.75933 + 29.53058868 * k + 0.0001178 * T2 - 0.000000155 * T3;
            Jd1 = Jd1 + 0.00033 * Math.sin((166.56 + 132.87 * T - 0.009173 * T2) * dr);
            let M = 359.2242 + 29.10535608 * k - 0.0000333 * T2 - 0.00000347 * T3;
            let Mpr = 306.0253 + 385.81691806 * k + 0.0107306 * T2 + 0.00001236 * T3;
            let F = 21.2964 + 390.67050646 * k - 0.0016528 * T2 - 0.00000239 * T3;
            let C1 = (0.1734 - 0.000393 * T) * Math.sin(M * dr) + 0.0021 * Math.sin(2 * dr * M);
            C1 = C1 - 0.4068 * Math.sin(Mpr * dr) + 0.0161 * Math.sin(dr * 2 * Mpr);
            C1 = C1 - 0.0004 * Math.sin(dr * 3 * Mpr);
            C1 = C1 + 0.0104 * Math.sin(dr * 2 * F) - 0.0051 * Math.sin(dr * (M + Mpr));
            C1 = C1 - 0.0074 * Math.sin(dr * (M - Mpr)) + 0.0004 * Math.sin(dr * (2 * F + M));
            C1 = C1 - 0.0004 * Math.sin(dr * (2 * F - M)) - 0.0006 * Math.sin(dr * (2 * F + Mpr));
            C1 = C1 + 0.0010 * Math.sin(dr * (2 * F - Mpr)) + 0.0005 * Math.sin(dr * (2 * Mpr + M));
            let deltat;
            if (T < -11) {
                deltat = 0.001 + 0.000839 * T + 0.0002261 * T2 - 0.00000845 * T3 - 0.000000081 * T * T3;
            } else {
                deltat = -0.000278 + 0.000265 * T + 0.000262 * T2;
            }
            let JdNew = Jd1 + C1 - deltat;
            return Math.floor(JdNew + 0.5 + timeZone / 24);
        }

        function getSunLongitude(jdn, timeZone) {
            let T = (jdn - 2451545.5 - timeZone / 24) / 36525;
            let T2 = T * T;
            let dr = PI / 180;
            let M = 357.52910 + 35999.05030 * T - 0.0001559 * T2 - 0.00000048 * T * T2;
            let L0 = 280.46645 + 36000.76983 * T + 0.0003032 * T2;
            let DL = (1.914600 - 0.004817 * T - 0.000014 * T2) * Math.sin(dr * M);
            DL = DL + (0.019993 - 0.000101 * T) * Math.sin(dr * 2 * M) + 0.00029 * Math.sin(dr * 3 * M);
            let L = L0 + DL;
            L = L * dr;
            L = L - PI * 2 * Math.floor(L / (PI * 2));
            return Math.floor(L / PI * 6);
        }

        function getLunarMonth11(yy, timeZone) {
            let off = jdFromDate(31, 12, yy) - 2415021;
            let k = Math.floor(off / 29.530588853);
            let nm = getNewMoonDay(k, timeZone);
            let sunLong = getSunLongitude(nm, timeZone);
            if (sunLong >= 9) {
                nm = getNewMoonDay(k - 1, timeZone);
            }
            return nm;
        }

        function getLeapMonthOffset(a11, timeZone) {
            let k = Math.floor((a11 - 2415021.076998695) / 29.530588853 + 0.5);
            let last = 0;
            let i = 1;
            let arc = getSunLongitude(getNewMoonDay(k + i, timeZone), timeZone);
            do {
                last = arc;
                i++;
                arc = getSunLongitude(getNewMoonDay(k + i, timeZone), timeZone);
            } while (arc !== last && i < 14);
            return i - 1;
        }

        function convertSolar2Lunar(dd, mm, yy, timeZone) {
            let dayNumber = jdFromDate(dd, mm, yy);
            let k = Math.floor((dayNumber - 2415021.076998695) / 29.530588853);
            let monthStart = getNewMoonDay(k + 1, timeZone);
            if (monthStart > dayNumber) {
                monthStart = getNewMoonDay(k, timeZone);
            }
            let a11 = getLunarMonth11(yy, timeZone);
            let b11 = a11;
            let lunarYear;
            if (a11 >= monthStart) {
                lunarYear = yy;
                a11 = getLunarMonth11(yy - 1, timeZone);
            } else {
                lunarYear = yy + 1;
                b11 = getLunarMonth11(yy + 1, timeZone);
            }
            let lunarDay = dayNumber - monthStart + 1;
            let diff = Math.floor((monthStart - a11) / 29);
            let lunarLeap = 0;
            let lunarMonth = diff + 11;
            if (b11 - a11 > 365) {
                let leapMonthDiff = getLeapMonthOffset(a11, timeZone);
                if (diff >= leapMonthDiff) {
                    lunarMonth = diff + 10;
                    if (diff === leapMonthDiff) {
                        lunarLeap = 1;
                    }
                }
            }
            if (lunarMonth > 12) {
                lunarMonth = lunarMonth - 12;
            }
            if (lunarMonth >= 11 && diff < 4) {
                lunarYear -= 1;
            }
            return [lunarDay, lunarMonth, lunarYear, lunarLeap];
        }

        function convertLunar2Solar(lunarDay, lunarMonth, lunarYear, lunarLeap, timeZone) {
            let a11, b11;
            if (lunarMonth < 11) {
                a11 = getLunarMonth11(lunarYear - 1, timeZone);
                b11 = getLunarMonth11(lunarYear, timeZone);
            } else {
                a11 = getLunarMonth11(lunarYear, timeZone);
                b11 = getLunarMonth11(lunarYear + 1, timeZone);
            }
            let k = Math.floor(0.5 + (a11 - 2415021.076998695) / 29.530588853);
            let off = lunarMonth - 11;
            if (off < 0) {
                off += 12;
            }
            if (b11 - a11 > 365) {
                let leapOff = getLeapMonthOffset(a11, timeZone);
                let leapMonth = leapOff - 2;
                if (leapMonth < 0) {
                    leapMonth += 12;
                }
                if (lunarLeap !== 0 && lunarMonth !== leapMonth) {
                    return [0, 0, 0];
                } else if (lunarLeap !== 0 || off >= leapOff) {
                    off += 1;
                }
            }
            let monthStart = getNewMoonDay(k + off, timeZone);
            return jdToDate(monthStart + lunarDay - 1);
        }

        function getCanChi(lunarYear) {
            return CAN[(lunarYear + 6) % 10] + ' ' + CHI[(lunarYear + 8) % 12];
        }

        function getCanChiDay(jd) {
            return CAN[(jd + 9) % 10] + ' ' + CHI[(jd + 1) % 12];
        }

        function getCanChiMonth(lunarMonth, lunarYear) {
            let can = (lunarYear * 12 + lunarMonth + 3) % 10;
            return CAN[can] + ' ' + CHI[(lunarMonth + 1) % 12];
        }

        function getTietKhi(jd, timeZone) {
            let sunLong = getSunLongitude(jd, timeZone);
            return TIET_KHI[sunLong];
        }

        // Initialize dropdowns
        function initDropdowns() {
            const solarDay = document.getElementById('solar-day');
            const solarMonth = document.getElementById('solar-month');
            const lunarDay = document.getElementById('lunar-day');
            const lunarMonth = document.getElementById('lunar-month');

            for (let i = 1; i <= 31; i++) {
                solarDay.innerHTML += `<option value="${i}">${i}</option>`;
            }
            for (let i = 1; i <= 30; i++) {
                lunarDay.innerHTML += `<option value="${i}">${i}</option>`;
            }
            for (let i = 1; i <= 12; i++) {
                solarMonth.innerHTML += `<option value="${i}">${i}</option>`;
                lunarMonth.innerHTML += `<option value="${i}">${i}</option>`;
            }

            // Set current date
            const today = new Date();
            solarDay.value = today.getDate();
            solarMonth.value = today.getMonth() + 1;
            document.getElementById('solar-year').value = today.getFullYear();

            const lunar = convertSolar2Lunar(today.getDate(), today.getMonth() + 1, today.getFullYear(), 7);
            lunarDay.value = lunar[0];
            lunarMonth.value = lunar[1];
            document.getElementById('lunar-year').value = lunar[2];
        }

        // Convert Solar to Lunar
        function convertSolarToLunar() {
            const day = parseInt(document.getElementById('solar-day').value);
            const month = parseInt(document.getElementById('solar-month').value);
            const year = parseInt(document.getElementById('solar-year').value);

            const lunar = convertSolar2Lunar(day, month, year, 7);
            const jd = jdFromDate(day, month, year);

            const leapText = lunar[3] ? ' (Nhuận)' : '';
            document.getElementById('lunar-date-result').textContent =
                `${lunar[0]}/${lunar[1]}${leapText}/${lunar[2]}`;

            document.getElementById('lunar-details').innerHTML = `
                <div class="detail-item">
                    <div class="label" data-lang="year-canchi">Năm Can Chi</div>
                    <div class="value">${getCanChi(lunar[2])}</div>
                </div>
                <div class="detail-item">
                    <div class="label" data-lang="month-canchi">Tháng Can Chi</div>
                    <div class="value">${getCanChiMonth(lunar[1], lunar[2])}</div>
                </div>
                <div class="detail-item">
                    <div class="label" data-lang="day-canchi">Ngày Can Chi</div>
                    <div class="value">${getCanChiDay(jd)}</div>
                </div>
                <div class="detail-item">
                    <div class="label" data-lang="tiet-khi">Tiết Khí</div>
                    <div class="value">${getTietKhi(jd, 7)}</div>
                </div>
            `;

            document.getElementById('solar-result').style.display = 'block';
            setLang(currentLang); // Reapply translations
        }

        // Convert Lunar to Solar
        function convertLunarToSolar() {
            const day = parseInt(document.getElementById('lunar-day').value);
            const month = parseInt(document.getElementById('lunar-month').value);
            const leap = parseInt(document.getElementById('lunar-leap').value);
            const year = parseInt(document.getElementById('lunar-year').value);

            const solar = convertLunar2Solar(day, month, year, leap, 7);

            if (solar[0] === 0) {
                document.getElementById('solar-date-result').textContent = 'Ngày không hợp lệ';
            } else {
                const dayName = DAY_NAMES[new Date(solar[2], solar[1] - 1, solar[0]).getDay()];
                document.getElementById('solar-date-result').textContent =
                    `${dayName}, ${solar[0]}/${solar[1]}/${solar[2]}`;
            }

            document.getElementById('lunar-result').style.display = 'block';
        }

        // Calendar variables
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();

        function renderCalendar() {
            const tbody = document.getElementById('calendar-body');
            tbody.innerHTML = '';

            const firstDay = new Date(currentYear, currentMonth, 1);
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            const startDay = firstDay.getDay();
            const totalDays = lastDay.getDate();

            const today = new Date();

            document.getElementById('calendar-title').textContent =
                `${MONTH_NAMES[currentMonth]} ${currentYear}`;

            let date = 1;
            let prevMonthDays = new Date(currentYear, currentMonth, 0).getDate();

            for (let week = 0; week < 6; week++) {
                if (date > totalDays) break;

                const tr = document.createElement('tr');

                for (let day = 0; day < 7; day++) {
                    const td = document.createElement('td');

                    if (week === 0 && day < startDay) {
                        const prevDate = prevMonthDays - startDay + day + 1;
                        td.classList.add('other-month');
                        td.innerHTML = `<div class="solar-day">${prevDate}</div>`;
                    } else if (date > totalDays) {
                        const nextDate = date - totalDays;
                        td.classList.add('other-month');
                        td.innerHTML = `<div class="solar-day">${nextDate}</div>`;
                        date++;
                    } else {
                        const lunar = convertSolar2Lunar(date, currentMonth + 1, currentYear, 7);
                        let lunarText = lunar[0];
                        if (lunar[0] === 1) {
                            lunarText = `${lunar[1]}/${lunar[0]}`;
                        }

                        td.innerHTML = `
                            <div class="solar-day">${date}</div>
                            <div class="lunar-day">${lunarText}</div>
                        `;

                        if (day === 0) td.classList.add('sunday');
                        if (day === 6) td.classList.add('saturday');

                        if (date === today.getDate() &&
                            currentMonth === today.getMonth() &&
                            currentYear === today.getFullYear()) {
                            td.classList.add('today');
                        }

                        const clickDate = date;
                        td.onclick = () => {
                            document.getElementById('solar-day').value = clickDate;
                            document.getElementById('solar-month').value = currentMonth + 1;
                            document.getElementById('solar-year').value = currentYear;
                            convertSolarToLunar();
                            window.scrollTo({ top: 0, behavior: 'smooth' });
                        };

                        date++;
                    }

                    tr.appendChild(td);
                }

                tbody.appendChild(tr);
            }
        }

        function changeMonth(delta) {
            currentMonth += delta;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            } else if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            renderCalendar();
        }

        function showToday() {
            const today = new Date();
            const lunar = convertSolar2Lunar(today.getDate(), today.getMonth() + 1, today.getFullYear(), 7);
            const jd = jdFromDate(today.getDate(), today.getMonth() + 1, today.getFullYear());

            document.getElementById('today-solar').textContent =
                `${DAY_NAMES[today.getDay()]}, ${today.getDate()}/${today.getMonth() + 1}/${today.getFullYear()}`;

            const leapText = lunar[3] ? ' (Nhuận)' : '';
            document.getElementById('today-lunar').textContent =
                `${lunar[0]}/${lunar[1]}${leapText} năm ${getCanChi(lunar[2])}`;

            document.getElementById('today-can-chi').textContent = getCanChiDay(jd);
            document.getElementById('today-tiet-khi').textContent = getTietKhi(jd, 7);
        }

        // i18n
        const translations = {
            vi: {
                'back': '← Quay lại trang chủ',
                'title': 'Chuyển Đổi Âm Lịch',
                'subtitle': 'Chuyển đổi giữa Dương lịch và Âm lịch Việt Nam',
                'today-title': 'Hôm Nay',
                'solar-to-lunar': 'Dương Lịch → Âm Lịch',
                'lunar-to-solar': 'Âm Lịch → Dương Lịch',
                'day': 'Ngày',
                'month': 'Tháng',
                'year': 'Năm',
                'leap-month': 'Tháng Nhuận',
                'no': 'Không',
                'yes': 'Có',
                'convert': 'Chuyển Đổi',
                'lunar-result': 'Kết Quả Âm Lịch',
                'solar-result': 'Kết Quả Dương Lịch',
                'year-canchi': 'Năm Can Chi',
                'month-canchi': 'Tháng Can Chi',
                'day-canchi': 'Ngày Can Chi',
                'tiet-khi': 'Tiết Khí',
                'sun': 'CN',
                'mon': 'T2',
                'tue': 'T3',
                'wed': 'T4',
                'thu': 'T5',
                'fri': 'T6',
                'sat': 'T7'
            },
            en: {
                'back': '← Back to Home',
                'title': 'Lunar Calendar Converter',
                'subtitle': 'Convert between Solar and Vietnamese Lunar Calendar',
                'today-title': 'Today',
                'solar-to-lunar': 'Solar → Lunar',
                'lunar-to-solar': 'Lunar → Solar',
                'day': 'Day',
                'month': 'Month',
                'year': 'Year',
                'leap-month': 'Leap Month',
                'no': 'No',
                'yes': 'Yes',
                'convert': 'Convert',
                'lunar-result': 'Lunar Calendar Result',
                'solar-result': 'Solar Calendar Result',
                'year-canchi': 'Year (Can Chi)',
                'month-canchi': 'Month (Can Chi)',
                'day-canchi': 'Day (Can Chi)',
                'tiet-khi': 'Solar Term',
                'sun': 'Sun',
                'mon': 'Mon',
                'tue': 'Tue',
                'wed': 'Wed',
                'thu': 'Thu',
                'fri': 'Fri',
                'sat': 'Sat'
            }
        };

        let currentLang = localStorage.getItem('lang') || 'vi';

        function setLang(lang) {
            currentLang = lang;
            localStorage.setItem('lang', lang);
            document.documentElement.lang = lang;
            document.getElementById('lang-text').textContent = lang === 'vi' ? 'EN' : 'VI';

            document.querySelectorAll('[data-lang]').forEach(el => {
                const key = el.getAttribute('data-lang');
                if (translations[lang][key]) {
                    el.textContent = translations[lang][key];
                }
            });
        }

        function toggleLang() {
            setLang(currentLang === 'vi' ? 'en' : 'vi');
        }

        // Initialize
        initDropdowns();
        showToday();
        renderCalendar();
        setLang(currentLang);
    </script>
</body>
</html>
